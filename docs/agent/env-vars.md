# 环境变量

## 必需变量

```bash
DATABASE_URL=file:./data/db.sqlite
LICENSE_KEY=CCUT-XXXXXXXX-XXXX           # 联系翔宇工作流获取
```

授权码格式：`CCUT-{8-14字符}-{4字符}`

## 系统密钥（自动管理）

```bash
ENCRYPTION_KEY=<自动生成>  # API 密钥加密（64 字符十六进制）
SESSION_SECRET=<自动生成>  # Session 签名（64 字符十六进制）
```

**优先级**：环境变量 > 数据库 configs 表 > 首次启动自动生成

**密钥处理**：
- 64 位十六进制字符串 → 直接使用
- 其他格式 → SHA-256 哈希转换为 32 字节

## 可选变量

### 鉴权配置

```bash
AUTH_ENABLED=true           # 生产环境设为 true
```

> **AUTH_ENABLED 默认行为**：未设置或空值时默认为 `true`（安全优先）
>
> **支持值**：`true`/`1`/`yes`/`on`/`enabled` 或 `false`/`0`/`no`/`off`/`disabled`
>
> **Session 有效期**：代码硬编码为 7 天（`lib/auth/config.ts:70`）

### 文件目录

```bash
RUNTIME_DIR=/tmp/chuangcut   # 运行时数据根目录（默认）
TEMP_DIR=/tmp/chuangcut/temp  # 临时文件目录
OUTPUT_DIR=/tmp/chuangcut/output  # 输出文件目录
```

> **重要**：本地开发时，运行时目录默认使用 `/tmp/chuangcut`（系统临时目录）
>
> **原因**：Next.js 16 Turbopack 无法排除监听目录，如果 output/temp 在项目内，
> 工作流产生的大量文件会触发重编译导致 CPU 飙升。详见 `lib/utils/paths.ts`
>
> **日志目录**：硬编码为 `./logs`（`lib/utils/logger.ts:87`），环境变量不生效

### 日志配置

```bash
LOG_LEVEL=info              # debug | info | warn | error
ENABLE_DEBUG_LOGS=false     # 启用详细中间状态日志
LOG_FILE_ENABLED=true       # 启用文件日志（默认启用）
```

### 运行时配置

```bash
NODE_OPTIONS=--max-old-space-size=4096  # Node.js 内存限制（开发/生产环境自动设置）
```

### 跨域配置

```bash
CORS_ALLOWED_ORIGINS=https://example.com,https://app.example.com
```

**说明**：
- 多个域名用逗号分隔，不要有空格
- 不设置时默认允许同源请求
- 生产环境建议明确设置允许的域名列表

### 客户端变量

```bash
NEXT_PUBLIC_BASE_URL=       # API 基础 URL（Client Component 使用）
NEXT_PUBLIC_APP_LOGO=       # 自定义 Logo URL（可选）
```

> **NEXT_PUBLIC_BASE_URL**：本地开发留空或设为 `http://localhost:8899`，Zeabur 部署时自动设置为 `${ZEABUR_WEB_URL}`

## Zeabur 部署环境

### 用户配置

| 变量 | 说明 |
|------|------|
| `LICENSE_KEY` | 软件授权码（必填） |

### 自动生成

| 变量 | 类型 |
|------|------|
| `ENCRYPTION_KEY` | PASSWORD（自动生成） |
| `SESSION_SECRET` | PASSWORD（自动生成） |

### 系统默认

| 变量 | 默认值 | 备注 |
|------|--------|------|
| `DATABASE_URL` | `file:/data/db.sqlite` | 必需 |
| `AUTH_ENABLED` | `true` | 安全优先 |
| `TEMP_DIR` | `/data/temp` | Docker 路径 |
| `OUTPUT_DIR` | `/data/output` | Docker 路径 |

> **硬编码值**（环境变量不生效）：
> - Session 有效期：7 天
> - 日志目录：`./logs`

## 本地开发 .env.local 示例

```bash
# 授权系统
LICENSE_KEY=CCUT-XXXXXXXX-XXXX

# 数据库
DATABASE_URL=file:./data/db.sqlite

# 加密密钥（可选，会自动生成）
ENCRYPTION_KEY=your-encryption-key

# 鉴权（开发环境可关闭）
AUTH_ENABLED=false

# 文件目录
TEMP_DIR=./temp
OUTPUT_DIR=./output

# 日志级别
LOG_LEVEL=debug
ENABLE_DEBUG_LOGS=true
```
