# 批量旁白生成参数模板（统一参数层）
# v4.0.1 - 新增语言参数
#
# 说明：
# - 本文件由系统自动管理，包含输入信息和输出规范
# - 用户风格文件（styles/style-*.yaml）中的 audio_sync_creative_layer 会与本模板组合
# - 适用于批处理模式（batch_size >= 1，可能为 1 个或多个分镜）
#
# 占位符说明：
# - {{batch_index}} - 当前批次序号（1-based）
# - {{total_batches}} - 总批次数量
# - {{batch_size}} - 当前批次分镜数量
# - {{narration_language}} - 旁白语言代码（如 zh-CN、en-US）
# - {{scenes_detail}} - 当前批次分镜详情列表
#
# v12.2 架构：视频内容 + 分析对话已缓存到 Context Cache，AI 可直接访问

template: |
  # 执行任务

  基于上述创作原则，执行以下任务。

  ---

  ## 上下文说明

  **当前批次**: 第 {{batch_index}}/{{total_batches}} 批（共 {{batch_size}} 个分镜）

  **旁白语言**: {{narration_language}}

  > **注意**：视频内容和分析结果（含完整分镜脚本）已缓存在 Context Cache 中。
  > 你可以直接引用前面对话中的分镜列表，理解整体叙事逻辑。

  ---

  ## 当前批次分镜列表

  > 本批次包含 {{batch_size}} 个分镜（可能为 1 个或多个），请依次处理并统一输出。

  {{scenes_detail}}

  ---

  ## 硬性约束（违反=输出无效）

  | 约束 | 要求 |
  |------|------|
  | JSON 结构 | 必须是合法的 JSON 格式，无语法错误 |
  | 数组长度 | scenes 数组长度 = {{batch_size}} |
  | 长度精确 | 每版长度必须精确匹配该分镜的要求（不含标点符号） |
  | 顺序一致 | 输出顺序与输入分镜顺序一致 |
  | 字段完整 | 每个分镜必须包含 scene_id, narration_v1, narration_v2, narration_v3 四个字段 |

  ### 常见错误

  - JSON 语法错误（缺少逗号、引号不匹配、多余逗号）
  - 字数超出或不足要求
  - 遗漏某个分镜的输出
  - 旁白与画面内容矛盾

  ---

  ## 输出格式

  只输出一个合法的 JSON 对象，禁止输出任何分析过程或说明文字。

  > scenes 数组长度 = 输入分镜数量（单分镜时为 1，多分镜时为 N）

  ```json
  {
    "scenes": [
      {
        "scene_id": "scene_001",
        "narration_v1": "符合该分镜字数要求的快语速旁白",
        "narration_v2": "符合该分镜字数要求的中语速旁白",
        "narration_v3": "符合该分镜字数要求的慢语速旁白"
      }
    ]
  }
  ```
