# 系统级提示词模板

本目录包含跨风格复用的提示词参数层模板，由系统自动管理。

## 文件说明

### `analysis_params.yaml`
分析提示词的参数层模板，包含：
- **输入信息**：任务配置参数（分镜数量、频道名称、语言等）
- **输出规范**：JSON Schema 定义、技术约束、格式要求

**使用场景**：所有风格的视频分析阶段

### `audio_sync_creative_default.yaml`
音画同步创意层的默认模板，包含：
- **角色定位**：短视频旁白导演（音画同步改写专家）
- **核心能力**：画面解读、字数控制、风格延续
- **创作原则**：忠实画面、精准控字、统一语感、三版差异

**使用场景**：风格未定义 `audio_sync_creative_layer` 时使用此默认

### `batch_audio_sync_params.yaml`
批量音画同步参数层模板，包含：
- **上下文说明**：提示 AI 分析对话已缓存（v12.2 架构优化）
- **当前批次分镜列表**：详细分镜数据（时间戳、旁白初稿、目标字数）
- **输出格式**：JSON Schema 定义（scene_id, narration_v1/v2/v3）

**使用场景**：所有风格的旁白批量生成阶段（100% 复用）

**v12.2 架构**：视频内容 + 分析对话已缓存到 Context Cache，AI 可直接访问前面对话中的完整分镜脚本

## 工作原理

### 提示词组合公式
```
最终提示词 = 创意层（风格文件或默认） + 参数层（本目录模板）
```

### 音画同步流程
所有旁白生成统一走批量模式（batch_size >= 2）：
1. 系统将分镜按批次分组
2. 每批次调用 `buildBatchAudioSyncPrompt()` 构建提示词
3. 创意层：风格 `audio_sync_creative_layer` 或 `audio_sync_creative_default.yaml`
4. 参数层：`batch_audio_sync_params.yaml`

### 变量替换
参数层中的变量会在运行时自动替换为实际值：

| 占位符 | 说明 | 示例 |
|--------|------|------|
| `{{batch_index}}` | 当前批次序号 | `1` |
| `{{total_batches}}` | 总批次数 | `5` |
| `{{batch_size}}` | 本批次分镜数量 | `8` |
| `{{scenes_detail}}` | 当前批次分镜详情 | Markdown 表格 |

> **v12.2 变更**：移除 `{{global_context_summary}}`，分析对话已缓存到 Context Cache

## 修改指南

### 重要提示
- 本目录文件由系统维护，修改会影响所有风格
- 如需自定义音画同步创意层，在风格 YAML 中设置 `audio_sync_creative_layer` 字段
- 参数层 100% 复用，暂不支持风格级覆盖

### 如何自定义创意层
在风格 YAML 文件中添加：
```yaml
# 自定义音画同步创意层（覆盖系统默认）
audio_sync_creative_layer: |
  # 我的专属旁白导演
  你是专注于 XXX 风格的旁白优化专家...
```

## 版本历史

- **v4.1.0** (2025-12-11): v12.2 架构优化，分析对话缓存到 Context Cache，移除 `global_context_summary`
- **v4.0.0** (2025-12-11): 统一批量模式，移除单分镜模式，新增全局上下文支持
- **v0.4.0** (2025-01-15): 初始化系统级模板架构
